{"version":3,"file":"sitevisits.min.js","sources":["../../src/widgets/sitevisits.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Site visits - chart init.\n *\n * @module     report_lmsace_reports/sitevisits\n * @copyright  2023 LMSACE <https://lmsace.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/loadingicon', 'core/chartjs', 'report_lmsace_reports/chartjs-plugin-datalabels'],\n    function ($, AJAX, LoadIcon) {\n\n        /* global sitevisits */\n\n        var visitchart = null;\n        var loadiconElement = $(\".site-visits-block .loadiconElement\");\n\n        /**\n         * Create a chart for the site visits.\n         *\n         * @param {report_lmsace_reports/main} main\n         */\n        function init(main) {\n\n            if (typeof sitevisits === 'undefined') {\n                return null;\n            }\n\n            var label = sitevisits.label;\n            var datavalue = sitevisits.value;\n            showVisitChart(main, label, datavalue);\n\n            $(\".site-visits-block .dropdown-menu a\").click(function () {\n                var selText = $(this).text();\n                var filter = $(this).attr(\"value\");\n                $(this).parents('.dropdown').find('#daterangefiltermenu').html(selText + ' <span class=\"caret\"></span>');\n                $(this).parents('.dropdown').find('#daterangefiltermenu').attr(\"data-filter\", filter);\n                getVisitsRecords(filter);\n            });\n\n            return true;\n        }\n\n        /**\n         * Show chart.\n         *\n         * @param {report_lmsace_reports/main} main\n         * @param {String} label\n         * @param {Object} datavalue\n         */\n        var showVisitChart = function (main, label, datavalue) {\n\n            let ctx = document.getElementById('site-visits-chart');\n\n            if (ctx) {\n                var bgColor = main.getRandomColors(['c7'], '.5', true); // Get bg color with opaticty.\n                var borderColor = main.getRandomColors(['c7']); // Get border color without opaticty.\n\n                var bgColor2 = main.getRandomColors(['c4'], '.5', true); // Get bg color with opaticty.\n                var borderColor2 = main.getRandomColors(['c4']); // Get border color without opaticty.\n\n                var bgColor3 = main.getRandomColors(['c6'], '.5', true); // Get bg color with opaticty.\n                var borderColor3 = main.getRandomColors(['c6']); // Get border color without opaticty.\n\n                var customConfig = {\n                    options: main.getMultiDatasetOptions(),\n                    data: {\n                        datasets: [{\n                            label: ctx.dataset.sitevisits,\n                            data: datavalue.sitevisits,\n                            backgroundColor: bgColor,\n                            borderColor: borderColor,\n                            fill: true,\n                            datalabels: {\n                                align: -45,\n                            },\n                        },\n                        {\n                            label: ctx.dataset.coursevisits,\n                            data: datavalue.coursevisits,\n                            backgroundColor: bgColor2,\n                            borderColor: borderColor2,\n                            fill: true,\n                            datalabels: {\n                                align: 'left',\n                            }\n                        },\n                        {\n                            label: ctx.dataset.modulevisits,\n                            data: datavalue.modulevisits,\n                            backgroundColor: bgColor3,\n                            borderColor: borderColor3,\n                            fill: true,\n                            datalabels: {\n                                align: 45,\n                            },\n                        }]\n                    }\n                };\n                visitchart = main.buildChart(ctx, 'line', label, null, null, customConfig);\n            }\n        };\n\n        var getVisitsRecords = function (filter) {\n            if (!filter) {\n                filter = 'week';\n            }\n\n            var request = {\n                methodname: 'report_lmsace_reports_site_visits',\n                args: {\n                    filter: filter,\n                    chartid: 'sitevisitswidget'\n                }\n            };\n            var promise = AJAX.call([request])[0];\n            promise.done(function (result) {\n                updateChartData(result);\n            });\n            LoadIcon.addIconToContainerRemoveOnCompletion(loadiconElement, promise);\n        };\n\n        var updateChartData = function (data) {\n            visitchart.data.labels = data.label;\n            visitchart.data.datasets[0].data = data.value.sitevisits;\n            visitchart.data.datasets[1].data = data.value.coursevisits;\n            visitchart.data.datasets[2].data = data.value.modulevisits;\n            visitchart.update();\n        };\n\n        return {\n            init: init\n        };\n    });\n"],"names":["define","$","AJAX","LoadIcon","visitchart","loadiconElement","showVisitChart","main","label","datavalue","ctx","document","getElementById","bgColor","getRandomColors","borderColor","bgColor2","borderColor2","bgColor3","borderColor3","customConfig","options","getMultiDatasetOptions","data","datasets","dataset","sitevisits","backgroundColor","fill","datalabels","align","coursevisits","modulevisits","buildChart","getVisitsRecords","filter","request","methodname","args","chartid","promise","call","done","result","updateChartData","addIconToContainerRemoveOnCompletion","labels","value","update","init","click","selText","this","text","attr","parents","find","html"],"mappings":";;;;;;;AAuBAA,kDAAO,CAAC,SAAU,YAAa,mBAAoB,eAAgB,oDAC/D,SAAUC,EAAGC,KAAMC,cAIXC,WAAa,KACbC,gBAAkBJ,EAAE,2CAmCpBK,eAAiB,SAAUC,KAAMC,MAAOC,eAEpCC,IAAMC,SAASC,eAAe,wBAE9BF,IAAK,KACDG,QAAUN,KAAKO,gBAAgB,CAAC,MAAO,MAAM,GAC7CC,YAAcR,KAAKO,gBAAgB,CAAC,OAEpCE,SAAWT,KAAKO,gBAAgB,CAAC,MAAO,MAAM,GAC9CG,aAAeV,KAAKO,gBAAgB,CAAC,OAErCI,SAAWX,KAAKO,gBAAgB,CAAC,MAAO,MAAM,GAC9CK,aAAeZ,KAAKO,gBAAgB,CAAC,OAErCM,aAAe,CACfC,QAASd,KAAKe,yBACdC,KAAM,CACFC,SAAU,CAAC,CACPhB,MAAOE,IAAIe,QAAQC,WACnBH,KAAMd,UAAUiB,WAChBC,gBAAiBd,QACjBE,YAAaA,YACba,MAAM,EACNC,WAAY,CACRC,OAAQ,KAGhB,CACItB,MAAOE,IAAIe,QAAQM,aACnBR,KAAMd,UAAUsB,aAChBJ,gBAAiBX,SACjBD,YAAaE,aACbW,MAAM,EACNC,WAAY,CACRC,MAAO,SAGf,CACItB,MAAOE,IAAIe,QAAQO,aACnBT,KAAMd,UAAUuB,aAChBL,gBAAiBT,SACjBH,YAAaI,aACbS,MAAM,EACNC,WAAY,CACRC,MAAO,QAKvB1B,WAAaG,KAAK0B,WAAWvB,IAAK,OAAQF,MAAO,KAAM,KAAMY,gBAIjEc,iBAAmB,SAAUC,QACxBA,SACDA,OAAS,YAGTC,QAAU,CACVC,WAAY,oCACZC,KAAM,CACFH,OAAQA,OACRI,QAAS,qBAGbC,QAAUtC,KAAKuC,KAAK,CAACL,UAAU,GACnCI,QAAQE,MAAK,SAAUC,QACnBC,gBAAgBD,WAEpBxC,SAAS0C,qCAAqCxC,gBAAiBmC,UAG/DI,gBAAkB,SAAUrB,MAC5BnB,WAAWmB,KAAKuB,OAASvB,KAAKf,MAC9BJ,WAAWmB,KAAKC,SAAS,GAAGD,KAAOA,KAAKwB,MAAMrB,WAC9CtB,WAAWmB,KAAKC,SAAS,GAAGD,KAAOA,KAAKwB,MAAMhB,aAC9C3B,WAAWmB,KAAKC,SAAS,GAAGD,KAAOA,KAAKwB,MAAMf,aAC9C5B,WAAW4C,gBAGR,CACHC,cA7GU1C,SAEgB,oBAAfmB,kBACA,SAGPlB,MAAQkB,WAAWlB,MACnBC,UAAYiB,WAAWqB,aAC3BzC,eAAeC,KAAMC,MAAOC,WAE5BR,EAAE,uCAAuCiD,OAAM,eACvCC,QAAUlD,EAAEmD,MAAMC,OAClBlB,OAASlC,EAAEmD,MAAME,KAAK,SAC1BrD,EAAEmD,MAAMG,QAAQ,aAAaC,KAAK,wBAAwBC,KAAKN,QAAU,gCACzElD,EAAEmD,MAAMG,QAAQ,aAAaC,KAAK,wBAAwBF,KAAK,cAAenB,QAC9ED,iBAAiBC,YAGd"}