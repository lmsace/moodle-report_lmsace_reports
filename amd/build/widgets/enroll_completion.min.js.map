{"version":3,"file":"enroll_completion.min.js","sources":["../../src/widgets/enroll_completion.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Enroll completion.\n *\n * @module     report_lmsace_reports/enroll_completion\n * @copyright  2023 LMSACE <https://lmsace.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/loadingicon', 'core/chartjs'], function ($, AJAX, LoadIcon, Chart) {\n\n    /* global courseenrolcompletion */\n\n    var chartreport = null;\n    var loadiconElement = $(\".enrol-completion-block  .loadiconElement\");\n\n    /**\n     * Display the completion chart and fetch the completion records when the event listener for the filter triggered.\n     */\n    function init() {\n        showEnrollCompletionChart();\n        $(\".enrol-completion-block .dropdown-menu a\").click(function () {\n            var selText = $(this).text();\n            var filter = $(this).attr(\"value\");\n            $(this).parents('.dropdown').find('#daterangefiltermenu').html(selText + ' <span class=\"caret\"></span>');\n            getEnrollCompletionRecords(filter);\n        });\n    }\n\n    var showEnrollCompletionChart = function () {\n        let ctx = document.getElementById('enrolment-completion-chart');\n        if (ctx) {\n            let config = {\n                type: 'doughnut',\n                data: {\n                    labels: courseenrolcompletion.label,\n                    datasets: [{\n                        data: courseenrolcompletion.value,\n                        backgroundColor: ['rgba(153, 102, 255, 1)', 'rgba(255, 159, 64, 1)'],\n                        showTooltips: false,\n                    }]\n                },\n                options: {\n                    responsive: true,\n                    plugins: {\n                        legend: {\n                            position: 'top',\n                        },\n                        title: {\n                            display: true,\n                            text: '',\n                        }\n                    }\n                },\n            };\n            chartreport = new Chart(ctx, config);\n        }\n    };\n\n    var getEnrollCompletionRecords = function (filter) {\n\n        if (!filter) {\n            filter = 'week';\n        }\n        var request = {\n            methodname: 'report_lmsace_reports_get_chart_reports',\n            args: {\n                filter: filter,\n                chartid: 'courseenrolcompletionwidget',\n                relatedid: courseenrolcompletion.courseid\n            }\n        };\n        var promise = AJAX.call([request])[0];\n        promise.done(function (result) {\n            updateChartData(result);\n        });\n        LoadIcon.addIconToContainerRemoveOnCompletion(loadiconElement, promise);\n    };\n\n    /**\n     * Update the chart data from the fetched dataset.\n     *\n     * @param {Array} result\n     */\n    function updateChartData(result) {\n        chartreport.data.labels = result.label;\n        chartreport.data.datasets[0].data = result.value;\n        chartreport.update();\n    }\n\n    return {\n        init: init\n    };\n});\n"],"names":["define","$","AJAX","LoadIcon","Chart","chartreport","loadiconElement","showEnrollCompletionChart","ctx","document","getElementById","config","type","data","labels","courseenrolcompletion","label","datasets","value","backgroundColor","showTooltips","options","responsive","plugins","legend","position","title","display","text","getEnrollCompletionRecords","filter","request","methodname","args","chartid","relatedid","courseid","promise","call","done","result","update","updateChartData","addIconToContainerRemoveOnCompletion","init","click","selText","this","attr","parents","find","html"],"mappings":";;;;;;;AAuBAA,yDAAO,CAAC,SAAU,YAAa,mBAAoB,iBAAiB,SAAUC,EAAGC,KAAMC,SAAUC,WAIzFC,YAAc,KACdC,gBAAkBL,EAAE,iDAepBM,0BAA4B,eACxBC,IAAMC,SAASC,eAAe,iCAC9BF,IAAK,KACDG,OAAS,CACTC,KAAM,WACNC,KAAM,CACFC,OAAQC,sBAAsBC,MAC9BC,SAAU,CAAC,CACPJ,KAAME,sBAAsBG,MAC5BC,gBAAiB,CAAC,yBAA0B,yBAC5CC,cAAc,KAGtBC,QAAS,CACLC,YAAY,EACZC,QAAS,CACLC,OAAQ,CACJC,SAAU,OAEdC,MAAO,CACHC,SAAS,EACTC,KAAM,OAKtBvB,YAAc,IAAID,MAAMI,IAAKG,UAIjCkB,2BAA6B,SAAUC,QAElCA,SACDA,OAAS,YAETC,QAAU,CACVC,WAAY,0CACZC,KAAM,CACFH,OAAQA,OACRI,QAAS,8BACTC,UAAWpB,sBAAsBqB,WAGrCC,QAAUnC,KAAKoC,KAAK,CAACP,UAAU,GACnCM,QAAQE,MAAK,SAAUC,kBAWFA,QACrBnC,YAAYQ,KAAKC,OAAS0B,OAAOxB,MACjCX,YAAYQ,KAAKI,SAAS,GAAGJ,KAAO2B,OAAOtB,MAC3Cb,YAAYoC,SAbRC,CAAgBF,WAEpBrC,SAASwC,qCAAqCrC,gBAAiB+B,gBAc5D,CACHO,gBAvEArC,4BACAN,EAAE,4CAA4C4C,OAAM,eAC5CC,QAAU7C,EAAE8C,MAAMnB,OAClBE,OAAS7B,EAAE8C,MAAMC,KAAK,SAC1B/C,EAAE8C,MAAME,QAAQ,aAAaC,KAAK,wBAAwBC,KAAKL,QAAU,gCACzEjB,2BAA2BC"}